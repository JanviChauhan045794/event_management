{% extends "sponsor/base.html" %}

{% block title %}Sponsored Events{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Page Header -->
    <div class="card border-0 shadow mb-4 animate__animated animate__fadeInDown">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div class="animate__animated animate__fadeInLeft" style="animation-delay: 0.2s">
                    <h2 class="mb-1">Your Sponsored Events</h2>
                    <p class="text-muted mb-0">Manage and track your event sponsorships.</p>
                </div>
                <div class="d-flex align-items-center gap-3 animate__animated animate__fadeInRight" style="animation-delay: 0.3s">
                    <div class="me-3">
                        <span class="text-muted">{{ today_date }}</span>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-download me-2"></i> Export Report
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow-sm" aria-labelledby="exportDropdown">
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="?export=pdf">
                                    <i class="fas fa-file-pdf me-2 text-danger"></i>
                                    <div>
                                        <div class="fw-medium">PDF Report</div>
                                        <small class="text-muted">Download detailed report</small>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="?export=excel">
                                    <i class="fas fa-file-excel me-2 text-success"></i>
                                    <div>
                                        <div class="fw-medium">Excel Report</div>
                                        <small class="text-muted">Export to spreadsheet</small>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sponsorship Stats -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="rounded-circle bg-primary bg-opacity-10 p-3 d-flex align-items-center justify-content-center animate__animated animate__bounceIn" style="width: 60px; height: 60px; animation-delay: 0.5s">
                                <i class="fas fa-handshake fa-2x text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="h2 mb-0 fw-bold animate__animated animate__fadeIn" style="animation-delay: 0.7s">{{ total_events }}</h3>
                            <p class="text-muted mb-0 animate__animated animate__fadeIn" style="animation-delay: 0.8s">Total Events</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="rounded-circle bg-success bg-opacity-10 p-3 d-flex align-items-center justify-content-center animate__animated animate__bounceIn" style="width: 60px; height: 60px; animation-delay: 0.6s">
                                <i class="fas fa-calendar-check fa-2x text-success"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="h2 mb-0 fw-bold animate__animated animate__fadeIn" style="animation-delay: 0.8s">{{ active_events }}</h3>
                            <p class="text-muted mb-0 animate__animated animate__fadeIn" style="animation-delay: 0.9s">Active Events</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.3s">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="rounded-circle bg-info bg-opacity-10 p-3 d-flex align-items-center justify-content-center animate__animated animate__bounceIn" style="width: 60px; height: 60px; animation-delay: 0.7s">
                                <i class="fas fa-users fa-2x text-info"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="h2 mb-0 fw-bold animate__animated animate__fadeIn" style="animation-delay: 0.9s">{{ total_attendees }}</h3>
                            <p class="text-muted mb-0 animate__animated animate__fadeIn" style="animation-delay: 1s">Total Attendees</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-0 shadow h-100 animate__animated animate__fadeInUp" style="animation-delay: 0.4s">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="rounded-circle bg-warning bg-opacity-10 p-3 d-flex align-items-center justify-content-center animate__animated animate__bounceIn" style="width: 60px; height: 60px; animation-delay: 0.8s">
                                <i class="fas fa-chart-line fa-2x text-warning"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="h2 mb-0 fw-bold animate__animated animate__fadeIn" style="animation-delay: 1s">{{ avg_engagement }}%</h3>
                            <p class="text-muted mb-0 animate__animated animate__fadeIn" style="animation-delay: 1.1s">Avg. Engagement</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="card border-0 shadow mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="timeFilter" class="form-label">Time Period</label>
                    <select class="form-select" id="timeFilter" name="time">
                        <option value="all" {% if time_filter == 'all' %}selected{% endif %}>All Time</option>
                        <option value="active" {% if time_filter == 'active' %}selected{% endif %}>Active</option>
                        <option value="upcoming" {% if time_filter == 'upcoming' %}selected{% endif %}>Upcoming</option>
                        <option value="past" {% if time_filter == 'past' %}selected{% endif %}>Past</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="tierFilter" class="form-label">Sponsorship Tier</label>
                    <select class="form-select" id="tierFilter" name="tier">
                        <option value="">All Tiers</option>
                        <option value="gold" {% if tier_filter == 'gold' %}selected{% endif %}>Gold</option>
                        <option value="silver" {% if tier_filter == 'silver' %}selected{% endif %}>Silver</option>
                        <option value="bronze" {% if tier_filter == 'bronze' %}selected{% endif %}>Bronze</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="viewType" class="form-label">View Type</label>
                    <select class="form-select" id="viewType" name="view">
                        <option value="list" {% if view_type == 'list' %}selected{% endif %}>List View</option>
                        <option value="grid" {% if view_type == 'grid' %}selected{% endif %}>Grid View</option>
                        <option value="calendar" {% if view_type == 'calendar' %}selected{% endif %}>Calendar View</option>
                    </select>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary float-end">
                        <i class="fas fa-filter me-2"></i>Apply Filters
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Events List View -->
    {% if view_type == 'list' %}
    <div class="card border-0 shadow">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="ps-4">Event</th>
                            <th>Date</th>
                            <th>Tier</th>
                            <th>Status</th>
                            <th>Attendees</th>
                            <th class="text-end pe-4">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in events %}
                        <tr>
                            <td class="ps-4">
                                <div class="d-flex align-items-center">
                                    {% if event.banner %}
                                        <img src="{{ event.banner.url }}" alt="{{ event.title }}" class="rounded me-3" style="width: 48px; height: 48px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                            <i class="fas fa-calendar-alt text-primary"></i>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <h6 class="mb-0">{{ event.title }}</h6>
                                        <small class="text-muted">{{ event.location }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div>{{ event.start_date|date:"M d, Y" }}</div>
                                <small class="text-muted">{{ event.start_date|date:"g:i A" }}</small>
                            </td>
                            <td>
                                {% if event.tier == 'gold' %}
                                    <span class="badge bg-warning text-dark">Gold</span>
                                {% elif event.tier == 'silver' %}
                                    <span class="badge bg-secondary">Silver</span>
                                {% else %}
                                    <span class="badge bg-danger">Bronze</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if event.status == 'active' %}
                                    <span class="badge bg-success">Active</span>
                                {% elif event.status == 'upcoming' %}
                                    <span class="badge bg-primary">Upcoming</span>
                                {% else %}
                                    <span class="badge bg-secondary">Past</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="me-2">{{ event.attendee_count }}</span>
                                    {% if event.attendee_trend > 0 %}
                                        <i class="fas fa-arrow-up text-success"></i>
                                    {% elif event.attendee_trend < 0 %}
                                        <i class="fas fa-arrow-down text-danger"></i>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="text-end pe-4">
                                <div class="btn-group">
                                    <a href="{% url 'event_detail' event.event_id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{% url 'sponsor_analytics' event.event_id %}" class="btn btn-sm btn-outline-info">
                                        <i class="fas fa-chart-bar"></i>
                                    </a>
                                    <a href="{% url 'sponsor_materials' event.event_id %}" class="btn btn-sm btn-outline-success">
                                        <i class="fas fa-upload"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <div class="py-5">
                                    <img src="https://cdn.iconscout.com/icon/free/png-256/free-calendar-1693591-1442634.png" alt="No Events" width="80" class="mb-3">
                                    <h5>No Sponsored Events</h5>
                                    <p class="text-muted">You haven't sponsored any events yet.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Events Grid View -->
    {% if view_type == 'grid' %}
    <div class="row">
        {% for event in events %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 border-0 shadow-sm hover-shadow">
                {% if event.banner %}
                    <img src="{{ event.banner.url }}" class="card-img-top" alt="{{ event.title }}" style="height: 160px; object-fit: cover;">
                {% endif %}
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary text-white rounded p-2 me-3 text-center" style="width: 45px;">
                            <div class="small">{{ event.start_date|date:"M" }}</div>
                            <div class="fw-bold">{{ event.start_date|date:"d" }}</div>
                        </div>
                        <div>
                            <h5 class="card-title mb-0">{{ event.title }}</h5>
                            <small class="text-muted">{{ event.location }}</small>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-clock text-primary me-2"></i>
                            <span>{{ event.start_date|date:"g:i A" }} - {{ event.end_date|date:"g:i A" }}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-users text-primary me-2"></i>
                            <span>{{ event.attendee_count }} Attendees</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-trophy text-primary me-2"></i>
                            <span>{{ event.tier|title }} Sponsor</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge {% if event.status == 'active' %}bg-success{% elif event.status == 'upcoming' %}bg-primary{% else %}bg-secondary{% endif %}">
                            {{ event.status|title }}
                        </span>
                        <div class="btn-group">
                            <a href="{% url 'event_detail' event.event_id %}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i> View
                            </a>
                            <a href="{% url 'sponsor_analytics' event.event_id %}" class="btn btn-sm btn-outline-info">
                                <i class="fas fa-chart-bar me-1"></i> Analytics
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="text-center py-5">
                <img src="https://cdn.iconscout.com/icon/free/png-256/free-calendar-1693591-1442634.png" alt="No Events" width="80" class="mb-3">
                <h5>No Sponsored Events</h5>
                <p class="text-muted">You haven't sponsored any events yet.</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Calendar View -->
    {% if view_type == 'calendar' %}
    <div class="row">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Sponsorship Summary</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted">Total Events</div>
                        <div class="fw-bold">{{ total_events }}</div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted">Active Events</div>
                        <div class="fw-bold">{{ active_events }}</div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted">Total Investment</div>
                        <div class="fw-bold">${{ total_investment|floatformat:2 }}</div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted">ROI</div>
                        <div class="fw-bold">{{ roi|floatformat:1 }}%</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events List -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Upcoming Events</h5>
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        {% for event in upcoming_events|slice:":5" %}
                            <li class="list-group-item">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary text-white rounded p-2 me-3 text-center" style="width: 45px;">
                                        <div class="small">{{ event.start_date|date:"M" }}</div>
                                        <div class="fw-bold">{{ event.start_date|date:"d" }}</div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="fw-bold">{{ event.title }}</div>
                                        <div class="small text-muted">{{ event.start_date|date:"g:i A" }}</div>
                                    </div>
                                    <a href="{% url 'event_detail' event.event_id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-center py-4">
                                <p class="text-muted mb-0">No upcoming events</p>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">Calendar View</h5>
                </div>
                <div class="card-body">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize auto-submit for filters
    const viewTypeSelect = document.getElementById('viewType');
    const timeFilterSelect = document.getElementById('timeFilter');
    const tierFilterSelect = document.getElementById('tierFilter');

    [viewTypeSelect, timeFilterSelect, tierFilterSelect].forEach(select => {
        if (select) {
            select.addEventListener('change', function() {
                this.form.submit();
            });
        }
    });

    // Initialize calendar if in calendar view
    if (document.getElementById('calendar')) {
        var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: {{ events_json|safe }},
            eventClick: function(info) {
                if (info.event.url) {
                    window.location.href = info.event.url;
                    info.jsEvent.preventDefault();
                }
            }
        });
        calendar.render();
    }

    // Add hover effect to event cards
    document.querySelectorAll('.hover-shadow').forEach(function(card) {
        card.addEventListener('mouseenter', function() {
            this.classList.add('shadow');
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
        });

        card.addEventListener('mouseleave', function() {
            this.classList.remove('shadow');
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %} 